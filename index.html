<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Family Tree Project</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <div class="leaves-container" id="leaves-container"></div>
    <div id="app-overlay"></div>
    
    <aside id="controls-bar" class="controls-sidebar">
        <div class="sidebar-header">
            <h3>Controls</h3>
            <button id="close-controls-btn" class="ui-icon-btn close-btn">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="control-section">
                <strong class="control-title">Filters</strong>
                <div class="filter-group">
                    <label for="side-filter">Family Side</label>
                    <select id="side-filter">
                        <option value="all">All Sides</option>
                        <option value="paternal">Paternal</option>
                        <option value="maternal">Maternal</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="level-filter">Generation</label>
                    <select id="level-filter">
                        <option value="all">All Generations</option>
                        <option value="0">Great-Grandparents</option>
                        <option value="1">Grandparents</option>
                        <option value="2">Parents</option>
                        <option value="3">Current</option>
                    </select>
                </div>
            </div>
            <div class="control-section">
                <strong class="control-title">View Options</strong>
                 <div class="toggle-group"><label for="toggle-lines">Show Connection Lines</label><label class="toggle-switch"><input type="checkbox" id="toggle-lines" checked><span class="slider"></span></label></div>
                <div class="toggle-group"><label for="toggle-roles">Show Relationship Roles</label><label class="toggle-switch"><input type="checkbox" id="toggle-roles" checked><span class="slider"></span></label></div>
                <div class="toggle-group"><label for="toggle-annotations">Show Relationship Notes</label><label class="toggle-switch"><input type="checkbox" id="toggle-annotations" checked><span class="slider"></span></label></div>
                <div class="toggle-group"><label for="toggle-extended">Show Extended Family</label><label class="toggle-switch"><input type="checkbox" id="toggle-extended" checked><span class="slider"></span></label></div>
                <div class="legend">
                    <div class="legend-item"><span class="color-swatch" style="background: var(--green-dark);"></span>Parent/Child</div>
                    <div class="legend-item"><span class="color-swatch" style="background: var(--blue);"></span>Sibling</div>
                    <div class="legend-item"><span class="color-swatch" style="background: var(--purple-extended);"></span>Extended</div>
                    <div class="legend-item"><span class="color-swatch" style="background: var(--green-dark); border-radius: 0;"></span>Role (on card)</div>
                    <div class="legend-item"><span class="color-swatch" style="background: var(--brown);"></span>Note (on line)</div>
                </div>
            </div>
            <div class="control-section" id="relationship-manager">
                <strong class="control-title">Relationship Manager</strong>
                <form id="relationship-form-sidebar">
                    <div class="filter-group"><label for="rel-from">From</label><select id="rel-from"></select></div>
                    <div class="filter-group"><label for="rel-to">To</label><select id="rel-to"></select></div>
                    <div class="filter-group"><label for="rel-type">Relationship Type</label>
                        <select id="rel-type">
                             <option value="Spouse">Spouse</option>
                             <option value="Parent-Child">Parent-Child</option>
                             <option value="Sibling">Sibling</option>
                             <option value="Extended">Extended</option>
                        </select>
                    </div>
                    <div class="filter-group"><label for="rel-status">Relationship Status</label>
                        <select id="rel-status">
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Partner">Partner</option>
                            <option value="Engaged">Engaged</option>
                            <option value="Separated">Separated</option>
                            <option value="Biological">Biological</option>
                            <option value="Adopted">Adopted</option>
                            <option value="Step-Relationship">Step-Relationship</option>
                            <option value="1st Cousin">1st Cousin</option>
                            <option value="2nd Cousin">2nd Cousin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Create Link</button>
                </form>
                <div class="filter-group">
                    <input type="search" id="search-relationships" placeholder="Search relationships...">
                </div>
                <div id="existing-relationships-list"></div>
            </div>
            <div class="control-section">
                <strong class="control-title">Data Management</strong>
                <button class="btn" id="importJsonBtn"><i class="fa-solid fa-upload"></i> Import JSON</button>
                <input type="file" id="json-file-input" accept=".json" style="display: none;">
                <div class="dropdown">
                    <button class="btn dropdown-btn"><i class="fa-solid fa-download"></i> Export Options <i class="fa-solid fa-chevron-down"></i></button>
                    <div class="dropdown-content">
                        <a href="#" id="exportJsonBtn"><i class="fa-solid fa-file-code"></i> Export as JSON</a>
                        <a href="#" id="exportPngBtn"><i class="fa-solid fa-image"></i> Export as PNG</a>
                        <a href="#" id="exportPdfBtn"><i class="fa-solid fa-file-pdf"></i> Export as PDF</a>
                        <a href="#" id="exportSvgBtn"><i class="fa-solid fa-file-code"></i> Export as SVG</a>
                        <a href="#" id="exportCsvBtn"><i class="fa-solid fa-file-csv"></i> Export as CSV</a>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <button class="ui-icon-btn" id="toggle-controls-btn" title="Toggle Controls">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <a href="index.html" class="logo">
                    <i class="fa-solid fa-tree"></i>
                    <span>The Family Tree Project</span>
                </a>
            </div>
            <nav class="main-nav">
                <a href="index.html" class="active">Home</a>
                <a href="how-to.html">How To</a>
                <a href="about.html">About</a>
            </nav>
            <div class="header-actions">
                <div class="search-container">
                    <i class="fa-solid fa-search"></i>
                    <input type="search" id="search-member" placeholder="Focus on a person..." list="member-names">
                    <datalist id="member-names"></datalist>
                </div>
            </div>
        </header>

        <main class="main-canvas" id="main-canvas">
            <div class="tree-container" id="tree-container">
                <div id="empty-state-message">
                    <i class="fa-solid fa-plus"></i>
                    <h2>Let's get started by adding a family member</h2>
                </div>
                <svg id="tree-connections" xmlns="http://www.w3.org/2000/svg"></svg>
                <div id="connection-annotations"></div>
                <div class="tree-layout" id="tree-layout"></div>
            </div>
        </main>
        
        <div class="ui-controls">
            <div class="view-controls">
                <button class="ui-icon-btn" id="globalResetBtn" title="Reset View & Filters"><i class="fa-solid fa-arrows-rotate"></i></button>
                <button class="ui-icon-btn" id="fullscreenBtn" title="Fullscreen"><i class="fa-solid fa-expand"></i></button>
                <button class="ui-icon-btn btn-danger" id="clearDataBtn" title="Clear All Data"><i class="fa-solid fa-trash"></i></button>
            </div>
            <div class="zoom-controls">
                <button id="zoomOutBtn"><i class="fa-solid fa-minus"></i></button>
                <span id="zoom-level">100%</span>
                <button id="zoomInBtn"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Edit Family Member</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <aside class="modal-sidebar">
                    <div class="modal-avatar-preview" id="modal-avatar-preview">
                        <span id="modal-avatar-initials"></span><img id="modal-avatar-img" src="" alt="Avatar Preview">
                        <div class="upload-overlay"><i class="fa-solid fa-camera"></i><span>Upload</span></div>
                    </div>
                    <input type="file" id="avatarUpload" accept="image/*">
                    <button class="btn" id="trigger-upload-btn"><i class="fa-solid fa-upload"></i> Change Photo</button>
                </aside>
                <form class="modal-main-form" id="edit-form">
                    <input type="hidden" id="memberId">
                    <div class="form-group"><label for="name">Full Name</label><input type="text" id="name" required></div>
                    <div class="form-group"><label for="relationship">Relationship Role</label>
                        <select id="relationship">
                            <option value="Son">Son</option><option value="Daughter">Daughter</option><option value="Father">Father</option><option value="Mother">Mother</option><option value="Step-Father">Step-Father</option><option value="Step-Mother">Step-Mother</option><option value="Grandfather">Grandfather</option><option value="Grandmother">Grandmother</option><option value="Husband">Husband</option><option value="Wife">Wife</option><option value="Partner">Partner</option><option value="Sibling">Sibling</option>
                        </select>
                    </div>
                    <div class="form-group"><label for="birthDate">Birth Date</label><input type="date" id="birthDate"></div>
                    <div class="form-group"><label for="deathDate">Date of Passing (optional)</label><input type="date" id="deathDate"></div>
                    <div class="form-group full-width"><label for="description">Personal Story / Notes</label><textarea id="description" rows="3"></textarea></div>
                    <div class="form-group full-width"><label>Tags</label>
                        <div class="tags-input-container" id="tags-input-container">
                            <input type="text" id="newTagInput" placeholder="Add a tag and press Enter">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="modal-cancel-btn">Cancel</button>
                <button class="btn btn-primary" id="modal-save-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="relationship-modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h2 class="modal-title" id="relationship-modal-title">Edit Relationship Note</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <form id="relationship-form-modal">
                <div class="modal-body">
                        <input type="hidden" id="relationshipId">
                        <div class="form-group full-width">
                            <label for="relationshipNote">Relationship Note</label>
                            <textarea id="relationshipNote" rows="3"></textarea>
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-relationship-btn">Delete</button>
                    <button type="button" class="btn" id="relationship-modal-cancel-btn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="relationship-modal-save-btn">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <template id="member-card-template">
        <div class="member-card" draggable="true">
            <button class="edit-button"><i class="fa-solid fa-pencil"></i></button>
            <div class="member-avatar">
                <img class="avatar-img" src="" alt="">
                <span class="avatar-initials"></span>
            </div>
            <h3 class="member-name"></h3>
            <p class="member-relationship"></p>
            <div class="member-details">
                <span class="birth-details"></span>
            </div>
            <div class="member-tags"></div>
        </div>
    </template>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <script type="module" src="js/main.js"></script>
</body>
</html>